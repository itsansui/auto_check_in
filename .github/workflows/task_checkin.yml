# 工作流名称：明确标注无GitHub定时，仅用于启动脚本
name: Task Checkin

# 触发条件：仅支持「推送测试」和「手动触发」，无任何自动定时（符合需求）
on:
  # 推送代码到main分支时触发（用于测试脚本是否能正常启动、依赖是否完整）
  push:
    branches: [ main ]
  # 手动触发（在GitHub Actions页面手动点击"Run workflow"启动，灵活可控）
  workflow_dispatch:

# 定义单个任务：仅负责启动脚本，不参与任何定时逻辑
jobs:
  start-checkin-script:
    # 选择兼容性最好的云端运行环境
    runs-on: ubuntu-latest

    # 任务执行步骤：完整流程保障脚本可启动
    steps:
      # 步骤1：拉取仓库代码（必选，云端Runner无本地脚本文件）
      - name: 拉取仓库代码到云端Runner
        uses: actions/checkout@v4

      # 步骤2：配置Python 3.10环境（匹配脚本运行需求）
      - name: 配置Python 3.10运行环境
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # 步骤3：安装脚本所需第三方依赖（requests + schedule）
      - name: 安装requests和schedule依赖包
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      # 步骤4：启动签到脚本（仅启动，后续逻辑由脚本自身控制）
      - name: 运行本地长期循环签到脚本
        run: python task_checkin.py
