# ==============================================================================
# GitHub Actions 定时任务工作流配置文件
# 文件名：.github/workflows/scheduled-task.yml（默认存放路径，需手动创建对应目录和文件）
# 功能：每天自动触发指定任务，此处以打印当前 UTC 时间为例，可扩展为其他业务逻辑（如数据备份、接口巡检等）
# ==============================================================================

# 工作流名称：用于在 GitHub Actions 面板中标识该工作流，可自定义
name: Task Checkin Workflow

# ==============================================================================
# 触发条件配置（on 关键字：指定触发工作流运行的事件）
# 此处使用 schedule 事件实现定时触发，支持 cron 表达式配置执行时间
# ==============================================================================
on:
  # 定时触发配置项：schedule 是 GitHub Actions 内置的定时事件
  schedule:
    # cron 表达式：用于定义定时执行的时间规则，格式为「分 时 日 月 周」
    # 语法说明：
    #   第 1 位：分钟（0-59），此处 0 表示整分执行
    #   第 2 位：小时（0-23），此处 2 表示 UTC 时间 2 点执行
    #   第 3 位：日期（1-31），此处 * 表示每天都执行
    #   第 4 位：月份（1-12），此处 * 表示每个月都执行
    #   第 5 位：星期（0-7，0 和 7 均表示周日），此处 * 表示每周的每一天都执行
    # 关键注意点：GitHub Actions 的 cron 表达式使用 **UTC 时间**（不是本地时间）
    # 时间转换示例：若你的本地时间是 UTC+8（中国标准时间），则 UTC 2 点 = 本地时间 10 点
    # 如需修改执行时间：例如本地凌晨 2 点执行，对应 UTC 时间为前一天的 18 点，cron 表达式应改为 '0 18 * * *'
    - cron: '0 2 * * *'

# ==============================================================================
# 任务配置（jobs 关键字：定义该工作流要执行的一系列任务，一个工作流可包含多个 jobs）
# 此处定义了一个名为 scheduled-task 的任务，jobs 内部是任务的具体步骤
# ==============================================================================
jobs:
  # 任务名称：scheduled-task（可自定义，用于标识该任务）
  scheduled-task:
    # 运行环境：指定任务在哪个操作系统环境中执行
    # 可选值：ubuntu-latest（推荐，轻量且高效）、windows-latest、macos-latest
    runs-on: ubuntu-latest

    # ==========================================================================
    # 步骤配置（steps 关键字：定义该任务要执行的具体步骤，按从上到下的顺序依次执行）
    # 每个 step 可以是「使用现成的 Action 插件」或「直接运行命令行指令」
    # ==========================================================================
    steps:
      # 步骤 1：拉取当前仓库的代码到运行环境中
      # name：步骤名称，用于在 Actions 运行日志中标识该步骤，可自定义
      - name: Checkout code
        # uses：使用 GitHub 官方提供的现成 Action 插件
        # actions/checkout@v4：拉取代码的插件，v4 是插件的版本号（推荐使用稳定版）
        # 作用：将当前仓库的代码克隆到 Ubuntu 运行环境中，后续步骤才能操作仓库内的文件
        # 注意：如果后续步骤不需要操作仓库代码，此步骤可省略
        uses: actions/checkout@v4

      # 步骤 2：打印当前的 UTC 时间，验证定时任务是否正常执行
      - name: Print current time
        # run：在运行环境的终端中执行命令行指令（此处是 Ubuntu 系统，支持 Linux 命令）
        # echo "当前 UTC 时间：$(date)"：Linux 命令，用于输出当前系统时间（UTC 时间）
        # 作用：验证定时任务是否按时触发，可在 Actions 运行日志中查看输出结果
        # 扩展：此处可替换为你的实际业务命令（如 python script.py、npm run build 等）
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      - name: Run auto_checkin
        run: |
          python task_checkin.py
